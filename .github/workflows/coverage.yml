name: Coverage

on:
    push:
    pull_request:
    workflow_dispatch:

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
        - uses: actions/checkout@v4
        - name: Set up Python 3.11
        uses: actions/setup-python@v3
        with:
            python-version: "3.11"

        - name: Install dependencies
        run: |
            python -m pip install --upgrade pip setuptools wheel
            python -m pip install .[dev]
        
        - name: Run tests
        run: |
            pytest --cov-config=.coveragerc --cov=./ci_course --cov-report=xml
        
        - name: Upload coverage reports to Codecov
        uses: codecov/codecov-action@v5
        with:
            token: ${{ secrets.CODECOV_TOKEN }}
            fail_ci_if_error: true
            files: coverage.xml